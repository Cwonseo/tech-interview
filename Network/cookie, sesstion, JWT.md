  쿠키와 세션, JWT를 확인하기 전에 HTTP의 특징에 대해 알아보자.

**HTTP 특징**

- 클라이언트-서버 구조
    
    <img src = "https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FOnL4v%2FbtrpUHuLzMb%2FwQvDJYnkFoTDWpk8UAFflk%2Fimg.png">
    
    - 클라이언트와 서버는 각각 독립적인 구조를 가지고 요청과 응답이 이뤄지므로 영향을 받지 않고 독립적으로 발전 가능하다.
    
- 무상태성(stateless)
    - 말 그대로 상태를 유지하지 않는 의미이다. 클라이언트와 서버가 요청과 응답을 반복하더라도 서버는 같은 클라이언트에서 온 요청인지 판별할 수 없다. 이러한 특성 때문에 세션, 쿠키 or 토큰 등을 활용하여 클라이언트가 누군지 알 수 있게 상태를 유지하는 것과 같은 효과를 낸다.
        - 왜 stateless 의 특징을 가질까?
            
            상태를 가지고 있단 것은 서버가 클라이언트의 정보를 저장하고 있단 것이며 요청마다 확인이 필요하다. 이 과정 또한 비용이다. 또한 많은 트래픽으로 인해 여러 서버가 있는 경우, 상태성을 가지기 위한 정보는 첫 통신이 이루어진 서버에 저장된다. 따라서 여러 서버가 있더라도 이미 통신된 서버 다시 통신하므로 효율적인 트래픽 처리를 할 수 없으며 해당 서버가 다운되는 경우, 사용자의 상태성 관련 정보가 전부 사라진다.
            
        
- 비연결성(connectionless)
    - 요청과 응답이 끝나면 연결이 끊어지는 것을 의미한다. 한 클라이언트와 서버가 지속적인 요청과 응답에 대한 통신이 필요하더라도 매번 요청과 응답을 기준으로 끊겼다가 다시 연결한다.
    - 왜 connectionless 해야 할까?

        <img src = "https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdcXDoS%2FbtrpJXznmVI%2FzzApue7U2JwlkFxviymAmk%2Fimg.png">
        
    
        마찬가지로 서버의 자원은 한정적이다. 수요가 공급보다 많아진다면 결국 성능 저하, 장애 등 문제가 발생한다. 서버의 자원을 효율적으로 사용하기 위해 connectionless의 특징을 가지는 것이다.
        
        **이러한 특징의 한계도 존재한다.** 일반적으로 TCP/IP는 3-way handshake 과정을 통해 연결이 이뤄지므로 요청이 많을수록 해당 과정 또한 배로 늘어난다.
        
        이를 위해 주로 사용되는 HTTP/1.1에서는 위 자원 낭비를 위해 지속 연결[Persistent Connection(keep-alive)]을 제공한다.
        
        연결을 끊지 않고 지속적으로 유지하여 불필요한 handshake를 줄여 성능을 개선한다.
        
        일반적으로 HTTP/1.1 은 keep-alive가 기본을 설정되어 Persistent Connection을 제공한다. header 설정에 따라 최대 통신 수, 시간 등 지속 연결에 대한  설정이 가능하다. 
        
        필요에 따라 적절하게 사용하자.
        
        자세한 내용 → [HTTP 0.9 ~ 1.1 특징](https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-HTTP-09-HTTP-30-%EA%B9%8C%EC%A7%80-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-%ED%86%B5%EC%8B%A0-%EA%B8%B0%EC%88%A0#http_/_0.9)
        

### 왜 HTTP의 특징을 확인했을까?

HTTP 특징으로 인해 서버는 같은 클라이언트와 연속적인 통신이 이루어지더라도 누군지 알 수 없다. 예를 들어, 상품을 장바구니에 담고 주문하는 상황을 보자.

어떤 사용자가 요청했는지 확인하기 위해 로그인 과정이 필요하다. HTTP 특성으로 인해 장바구니에 상품을 담는 행위를 하기 위해 로그인을 했지만 담은 장바구니에 있는 상품을 주문하기 위해서는 또다시 로그인 과정을 통해 누군지 확인해야 한다.

이러한 과정은 비효율적이다. 이러한 문제를 일반적으로 쿠키와 세션 또는 토큰(JWT) 방식으로  해결한다.

---

### 쿠키

클라이언트에 저장하는 이름, 값, 만료일(저장기간), 경로 정보로 구성되어있는 사용자의 기록 정보 파일입니다. 즉, 방문자의 정보를 방문자 컴퓨터의 메모리에 저장하는것(브라우저에 저장) 입니다.

클라이언트가 페이지를 요청하면 웹 서버에서 쿠키를 생성해 줍니다. 그래서 동일 사이트 재방문 시, 클라이언트의 PC에 해당 쿠키가 있는 경우 요청 페이지와 함께 쿠키를 전송해서 로그인을 유지할 수 있습니다. 제 3자가 조회할 수 있으니 보안에 위험한 정보를 저장하는 것은 적합하지 않다.

### 세션

일정 시간 동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지시키는 기술입니다. 

여기서 ‘일정 시간’이란 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말합니다. 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제가 되므로, 쿠키보다 비교적 보안이 좋습니다.

**쿠키, 세션을 사용한 인증 과정**

로그인을 통해 인증이 됐다면 서버는 해당 사용자에 대한 세션을 생성하여 저장하고 세션 ID를 쿠키에 담아 클라이언트에 전달한다.

이후, 클라이언트의 요청에는 해당 쿠키를 전달하므로 서버는 쿠키의 값을 통해 사용자 정보를 확인할 수 있다.

---

### JWT

Header + Payload + Signature로 구성된 JSON Web Token이다.

<img src = "https://velog.velcdn.com/images%2Fdnjscksdn98%2Fpost%2Fa8a6eafe-f0ac-4d01-a12f-c7366265af54%2Fjwt_example.png">

JSON 방식의 자료구조를 포함하고 용량이 작고 대표적인 암호화 방식을 모두 지원하는 매개이다.

- Header
    - typ(토큰 타입), alg(Signature 해싱 알고리즘)
- Payload
    - 토큰에 담을 정보로 Claim이라 부르며 Json 형태의 한 쌍으로 이뤄진다.
    - 등록된/공개/비공개 클레임이  존재하는데 필요에 따라 설정하면 된다.
- Signature
    - 토큰에 대한 고유한 암호화 코드로 헤더(Header)와 페이로드(Payload)의 값을 각각 BASE64로 인코딩하고, 인코딩한 값을 비밀 키를 이용해 헤더(Header)에서 정의한 알고리즘으로 해싱을 하고, 이 값을 다시 BASE64로 인코딩하여 생성한다.

서버의 고유 secret key를 통해 암호화하므로 해당 정보를 조작할 수 없다.

따라서 해당 JWT가 서버에서 발급한 것인지 판별 가능하며 해당 토큰의 신뢰성을 보장한다. 대신 누구나 공개키로 내용을 확인할 수 있으므로 보안의 위협이 될 정보는 담아서 안 된다.

토큰은 세션과 다르게 무상태성을 가지므로 서버에 가해지는 부하가 적지만 탈취된다면 이를 해결할 방법이 없다. 따라서 access token + refresh token 방식과 같이 여러 보안 처리가 필요하다.

 

### 질문

- 쿠키와 세션의 차이는?
    
    쿠키는 사용자의 브라우저(클라이언트)에 저장하는 정보이며 웹 브라우저를 닫아도 정보를 유지한다.(그렇지 않는 경우도 있음) 제 3자가 조회할 수 있어 보안의 취약합니다. 
    
    세션은 쿠키와 다르게 서버에 저장되며 웹 브라우저가 닫는 순간 삭제됩니다. 또한 서버에서 관리되므로 보안성이 높습니다.
    
- 세션의 동작 방식을 설명해주세요.
    
    로그인과 같은 인증 과정이 성공하며 해당 사용자에 대한 세션을 생성하여 서버에 저장한다. 생성된 세션의 ID를 쿠키에 담아 클라이언트에게 응답합니다. 이후, 클라이언트는 쿠키에 있는 세션 ID 값을 전달하여 로그인 과정 없이 인증과 인가가 이루어집니다. 
    
- 세션과 JWT 방식에 차이(장단점)는?
    
    세션 방식은 세션 ID 정보를 쿠키로 전달하여 서버에 해당 세션과 비교하여 인증하는 방식이다. 서버는 세션을 유지해야 하고 사용자의 수가 많아질수록 확인하는데 오랜 시간이 걸리며 서버에 부하가 가해지는 반면에 
    
    토큰 방식은 사용자 인증을 위한 토큰만 제공하고 유지하지 않으므로 서버에 가해지는 부하가 적습니다. 하지만 서버에서 토큰을 관리하지 않으므로 토큰이 탈취된다면 이를 해결할 수 없어 보안에 더 취약합니다.
    
     
    

**참고**

[hTTP 0.9 ~ 1.1 특징](https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-HTTP-09-HTTP-30-%EA%B9%8C%EC%A7%80-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-%ED%86%B5%EC%8B%A0-%EA%B8%B0%EC%88%A0#http_/_0.9)

[쿠키, 세션](https://nbcamp.spartacodingclub.kr/blog/개념-콕-웹-개발-지식-편-쿠키와-세션의-개념과-차이-21328?utm_source=google&utm_medium=pmax&utm_campaign=nbc&utm_content=frontend&utm_term=&gad_source=1&gclid=Cj0KCQjw4MSzBhC8ARIsAPFOuyW1Szvo5XHzjGag9KHUBZe_y6bFQH_FTw4Ff5E9OOVrJ1uAz8z8BVcaAvm4EALw_wcB#http_session_동작_순서_3)

[HTTP 특징](https://codingnojam.tistory.com/89)

[JWT](https://medium.com/@heoh06/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%EA%B8%B0%EC%88%A0%EB%A9%B4%EC%A0%91-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0-a01be5782c75)

[쿠키, 세션 관련 질문](https://medium.com/@heoh06/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%EA%B8%B0%EC%88%A0%EB%A9%B4%EC%A0%91-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0-a01be5782c75)